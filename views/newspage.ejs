<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
    </title>
    <link rel='stylesheet' href='/stylesheets/style.css' />
    <!-- CSS only -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css"
        integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">

    <style>
        .searchbar {
            margin-bottom: auto;
            margin-top: auto;
            height: 40px;
            background-color: #353b48;
            border-radius: 30px;
            padding: 2px;
        }

        .search_input {
            color: white;
            border: 0;
            outline: 0;
            background: none;
            width: 0;
            caret-color: transparent;
            line-height: 40px;
            transition: width 0.4s linear;
        }

        .searchbar:hover>.search_input {
            padding: 0 10px;
            width: 270px;
            caret-color: red;
            transition: width 0.4s linear;
        }

        .searchbar:hover>.search_icon {
            background: white;
            color: #e74c3c;
        }

        .search_icon {
            height: 35px;
            width: 35px;
            float: right;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 50%;
            color: white;
            text-decoration: none;
        }

        .dropdown-menu a {
            color: #ffffff;
        }

        .dropdown-menu {
            left: 86px !important;
        }
    </style>
</head>

<body>
    <% if(user==="user" ){ %>
        <div class=" position-fixed top-0 w-100" style="z-index: 3;">
            <ul class="nav bg-dark p-2">
                <li class="nav-item">
                    <a class="nav-link active  text-white" aria-current="page" href="/index-login">Home</a>
                </li>
                <li class="nav-item">
                    <div class="dropdown">
                        <a href="#" class="dropdown-toggle nav-link  text-white" type="button" id="dropdownMenuButton1"
                            data-bs-toggle="dropdown" aria-expanded="false">
                            Category
                        </a>
                        <ul class="dropdown-menu list-inline p-2 bg-dark text-white" id="select" style="width: 1000px;"
                            aria-labelledby="dropdownMenuButton1">
                            <li class="list-inline-item"><a class="dropdown-item"
                                    onclick="window.location.href='/index-login?category=trending'"
                                    category="trending">Trending</a></li>
                            <li class="list-inline-item"><a class="dropdown-item"
                                    onclick="window.location.href='/index-login?category=entertainment'"
                                    category="entertainment">Entertainment</a></li>
                            <li class="list-inline-item"><a class="dropdown-item"
                                    onclick="window.location.href='/index-login?category=sports'" category="sports">Sports</a></li>
                            <li class="list-inline-item"><a class="dropdown-item"
                                    onclick="window.location.href='/index-login?category=lifestyle'"
                                    category="lifestyle">Lifestyle</a></li>
                            <li class="list-inline-item"><a class="dropdown-item"
                                    onclick="window.location.href='/index-login?category=jobs'" category="jobs">Jobs</a></li>
                            <li class="list-inline-item"><a class="dropdown-item"
                                    onclick="window.location.href='/index-login?category=business'"
                                    category="business">Business</a></li>
                            <li class="list-inline-item"><a class="dropdown-item"
                                    onclick="window.location.href='/index-login?category=education'"
                                    category="education">Education</a></li>
                            <li class="list-inline-item"><a class="dropdown-item"
                                    onclick="window.location.href='/index-login?category=politics'"
                                    category="politics">Politics</a></li>
                            <li class="list-inline-item"><a class="dropdown-item"
                                    onclick="window.location.href='/index-login?category=mutual-funds'"
                                    category="mutual-funds">Mutual Funds</a></li>
                        </ul>
                    </div>
                </li>

                <li class="nav-item">
                    <a class="nav-link  text-white" href="/aboutlogin">About us</a>
                </li>

                <div class="justify-content-end d-flex  " style="width: 75%;">
                    <div>
                     
                    </div>
                    <button onclick="location.href='/logout'" class="btn btn-primary  me-3">Sign out</button>
                    <div class="text-white rounded-circle border-white border text-center "
                        style="width: 40px; height: 40px;" type="button" data-bs-toggle="collapse"
                        data-bs-target="#collapseWidthExample" aria-expanded="false"
                        aria-controls="collapseWidthExample">
                        <h3>
                            <%= name.substring(0,1) %>
                        </h3>
                    </div>
                    <div>
                        <div class="collapse collapse-horizontal" id="collapseWidthExample">
                            <div class="card p-2 ms-1 h-auto" style="width:fit-content;">
                                <%= name %>
                            </div>
                        </div>
                    </div>

                </div>
            </ul>
        </div>

        <% } else{ %>
            <div class=" position-fixed top-0 w-100" style="z-index: 3;">
                <ul class="nav bg-dark p-2">
                    <li class="nav-item">
                        <a class="nav-link active  text-white" aria-current="page" href="/admin">Home</a>
                    </li>
                    <li class="nav-item">
                        <div class="dropdown">
                            <a href="#" class="dropdown-toggle nav-link  text-white" type="button"
                                id="dropdownMenuButton1" data-bs-toggle="dropdown" aria-expanded="false">
                                Category
                            </a>
                            <ul class="dropdown-menu list-inline p-2 bg-dark text-white" id="select"
                                style="width: 1000px;" aria-labelledby="dropdownMenuButton1">
                                <li class="list-inline-item"><a class="dropdown-item"
                                        onclick="window.location.href='/admin?category=trending'"
                                        category="trending">Trending</a></li>
                                <li class="list-inline-item"><a class="dropdown-item"
                                        onclick="window.location.href='/admin?category=entertainment'"
                                        category="entertainment">Entertainment</a></li>
                                <li class="list-inline-item"><a class="dropdown-item"
                                        onclick="window.location.href='/admin?category=sports'" category="sports">Sports</a>
                                </li>
                                <li class="list-inline-item"><a class="dropdown-item"
                                        onclick="window.location.href='/admin?category=lifestyle'"
                                        category="lifestyle">Lifestyle</a></li>
                                <li class="list-inline-item"><a class="dropdown-item"
                                        onclick="window.location.href='/admin?category=jobs'" category="jobs">Jobs</a></li>
                                <li class="list-inline-item"><a class="dropdown-item"
                                        onclick="window.location.href='/admin?category=business'"
                                        category="business">Business</a></li>
                                <li class="list-inline-item"><a class="dropdown-item"
                                        onclick="window.location.href='/admin?category=education'"
                                        category="education">Education</a></li>
                                <li class="list-inline-item"><a class="dropdown-item"
                                        onclick="window.location.href='/admin?category=politics'"
                                        category="politics">Politics</a></li>
                                <li class="list-inline-item"><a class="dropdown-item"
                                        onclick="window.location.href='/admin?category=mutual-funds'"
                                        category="mutual-funds">Mutual Funds</a></li>
                            </ul>
                        </div>
                    </li>

                    <li class="nav-item">
                        <a class="nav-link  text-white" href="/aboutadmin">About us</a>
                    </li>

                    <div class="justify-content-end d-flex  " style="width: 75%;">
                        <div>
                           
                        </div>
                        <button onclick="location.href='/logout'" class="btn btn-primary  me-3">Sign out</button>
                        <div class="text-white rounded-circle border-white border text-center "
                            style="width: 40px; height: 40px;" type="button" data-bs-toggle="collapse"
                            data-bs-target="#collapseWidthExample" aria-expanded="false"
                            aria-controls="collapseWidthExample">
                            <h3>
                                <%= name.substring(0,1) %>
                            </h3>
                        </div>
                        <div>
                            <div class="collapse collapse-horizontal" id="collapseWidthExample">
                                <div class="card p-2 ms-1 h-auto" style="width:fit-content;">
                                    <%= name %>
                                </div>
                            </div>
                        </div>

                    </div>
                </ul>
            </div>

            <% } %>

                <div class=" back p-4">
                    <img onclick="history.back()" height="45px" width="45px" src="/images/back.png" alt="">
                </div>

                <div id="newshide">


                    <div class="container  mt-5 pt-4  <%= output[0].category %>">
                        <input type="hidden" id="newsid" value="<%= output[0]._id%>">
                        <input type="hidden" id="usersid" value="<%= output[0]._id%>">
                        <h3>
                            <%= output[0].title%>
                        </h3>
                        <img src="/attachments?filename=<%= output[0].images %>" alt="">
                        <p>
                            <%= output[0].content %>
                        </p>
                        <u style="color:rgb(0, 204, 255);">
                            <p style="color:rgb(0, 183, 255); ">#<%= output[0].category %>
                            </p>
                        </u>

                        <p>
                            <button class="btn btn-dark" type="button" data-bs-toggle="collapse"
                                data-bs-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample">
                                Add Comment
                            </button>
                        </p>

                        <form id="addcomment" method="post">
                            <div class="collapse " id="collapseExample" data-bs-toggle="collapse">
                                <div>
                                    <div class="mb-3">


                                        <input type="hidden" id="newsid" value="<%= output[0].newsid%>">
                                        


                                        <textarea class="form-control w-75" rows="3" name="comment"
                                            id="comment"></textarea>
                                    </div>
                                </div>
                                <button class="btn btn-outline-dark mb-3" type="submit">Post</button>
                            </div>

                            <div class="card p-2 mb-3 rounded " style="width: 85%;">
                                <h6>Comments</h6>
                                <% if(comments.length>0){
                                    comments.forEach((comment,i)=>{ %>
                                    <div class="sent_msg mt-2">
                                       
                                        <div><p class=""><i class="fas fa-user-circle"></i> <%= comment.user_details[0].name %><span> - <%=new Date(comment.date).toLocaleString("en-US",{month: 'short',day:'2-digit',hour:'numeric',minute:'numeric'})%></span></p><%= comment.comment %></div>
                                    </div>
                                    <% })} %>
                            </div>
                        </form>
                    </div>

                </div>

                <%- include('footer') -%>


                    <!-- JavaScript Bundle with Popper -->
                    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js"
                        integrity="sha384-pprn3073KE6tl6bjs2QrFaJGz5/SUsLqktiwsUTF55Jfv3qYSDhgCecCxMW52nD2"
                        crossorigin="anonymous"></script>
                    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"
                        integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ=="
                        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
                    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.5/jquery.validate.min.js"
                        integrity="sha512-rstIgDs0xPgmG6RX1Aba4KV5cWJbAMcvRCVmglpam9SoHZiUCyQVDdH2LPlxoHtrv17XWblE/V/PP+Tr04hbtA=="
                        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
                    <script
                        src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.5/additional-methods.min.js"
                        integrity="sha512-6S5LYNn3ZJCIm0f9L6BCerqFlQ4f5MwNKq+EthDXabtaJvg3TuFLhpno9pcm+5Ynm6jdA9xfpQoMz2fcjVMk9g=="
                        crossorigin="anonymous" referrerpolicy="no-referrer"></script>


                    <script>


                        $("#addcomment").validate({
                            rules: {
                                comment: {
                                    required: true
                                }

                            },
                            errorPlacement: function (error, element) {

                                error.addClass('invalid-feedback');

                                element.closest("div").append(error);

                            },

                            highlight: function (element, errorClass, validClass) {

                                $(element).addClass('is-invalid');

                            },

                            unhighlight: function (element, errorClass, validClass) {

                                $(element).removeClass('is-invalid');

                            },
                            submitHandler: function (form) {
                                try {

                                    let new_comment = {};
                                    new_comment.comment = $("#comment").val();
                                    new_comment.newsid = $("#newsid").val();
                                    new_comment.usersid = $("#usersid").val();
                              
                                    
                                    $.post("/newspage", { new_comment: JSON.stringify(new_comment) }).done(function (res) {
                                      
                                        if (res.Status === "Success") {
                                            
                                            window.location.reload();
                                        }
                                    })
                                } catch (err) {
                                    console.log(err)
                                }

                            }
                        });

                        $("#search-users").on("keyup", function () {
                            var value = $(this).val().toLowerCase();
                            $(".user").each(function () {
                                if ($(this).text().toLowerCase().indexOf(value) > -1) {
                                    $(this).removeClass("d-none")
                                }
                                else {
                                    $(this).addClass("d-none")
                                }
                            })
                        });

                        $(function () {
                            $('#select').children().click(function () {
                                let cl = $(this).find('a').attr('category')
                                console.log(cl)
                                // $('. title.category ').hide();
                                $('#newshide').children().each(function () {

                                    if ($(this).hasClass(cl)) {
                                        $(this).removeClass('d-none');
                                    } else {
                                        $(this).addClass('d-none');
                                    }
                                })
                            });
                        });

                    </script>


</body>

</html>